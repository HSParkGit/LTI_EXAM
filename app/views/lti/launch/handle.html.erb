<div class="container">
  <h1>LTI 1.3 Launch 성공</h1>
  
  <div class="info-section">
    <div>
      <span class="info-label">코스 ID:</span>
      <span><%= @course_id %></span>
    </div>
    <div style="margin-top: 10px;">
      <span class="info-label">코스 제목:</span>
      <span><%= @context_title || "N/A" %></span>
    </div>
    <div style="margin-top: 10px;">
      <span class="info-label">사용자:</span>
      <span><%= @user_name %> (<%= @user_sub %>)</span>
    </div>
    <div style="margin-top: 10px;">
      <span class="info-label">역할:</span>
      <span class="role-badge role-<%= @user_role %>">
        <%= @user_role == :instructor ? "강사 (Instructor)" : "학생 (Student)" %>
      </span>
    </div>
  </div>

  <% if @user_role == :instructor %>
    <div class="role-content">
      <h2>강사 전용 기능</h2>
      <p>강사로 로그인하셨습니다. 다음 기능을 사용할 수 있습니다:</p>
      <ul>
        <li>학생 관리</li>
        <li>과제 및 점수 관리</li>
        <li>코스 설정</li>
      </ul>
      <!-- 여기에 강사 전용 기능 추가 -->
    </div>
  <% else %>
    <div class="role-content">
      <h2>학생 전용 기능</h2>
      <p>학생으로 로그인하셨습니다. 다음 기능을 사용할 수 있습니다:</p>
      <ul>
        <li>과제 제출</li>
        <li>성적 조회</li>
        <li>코스 자료 확인</li>
      </ul>
      <!-- 여기에 학생 전용 기능 추가 -->
    </div>
  <% end %>

  <!-- 추가 정보 (디버깅/개발용) -->
  <div style="margin-top: 30px; padding: 15px; background-color: #f8f9fa; border-radius: 4px; border-left: 4px solid #6c757d;">
    <h3 style="margin-top: 0; color: #495057;">추가 정보 (사용 가능한 모든 LTI Claims)</h3>
    <details>
      <summary style="cursor: pointer; color: #007bff; margin-bottom: 10px;">자세히 보기</summary>
      <div style="margin-top: 10px; font-size: 13px; line-height: 1.6;">
        <h4>사용자 정보</h4>
        <ul>
          <li><strong>이름:</strong> <%= @lti_claims[:user_name] || "N/A" %></li>
          <li><strong>이름 (Given):</strong> <%= @lti_claims[:user_given_name] || "N/A" %></li>
          <li><strong>성 (Family):</strong> <%= @lti_claims[:user_family_name] || "N/A" %></li>
          <li><strong>이메일:</strong> <%= @lti_claims[:user_email] || "N/A" %></li>
          <li><strong>프로필 사진:</strong> <%= @lti_claims[:user_picture] || "N/A" %></li>
          <li><strong>User Sub:</strong> <%= @lti_claims[:user_sub] %></li>
          <% if @lti_claims[:canvas_user_id] %>
            <li><strong>Canvas User ID:</strong> <%= @lti_claims[:canvas_user_id] %></li>
          <% end %>
        </ul>

        <h4>코스 (Context) 정보</h4>
        <ul>
          <li><strong>코스 ID:</strong> <%= @lti_claims[:course_id] || "N/A" %></li>
          <li><strong>코스 제목:</strong> <%= @lti_claims[:context_title] || "N/A" %></li>
          <li><strong>코스 타입:</strong> <%= @lti_claims[:context_type] || "N/A" %></li>
          <li><strong>코스 레이블:</strong> <%= @lti_claims[:context_label] || "N/A" %></li>
          <% if @lti_claims[:canvas_course_id] %>
            <li><strong>Canvas Course ID:</strong> <%= @lti_claims[:canvas_course_id] %></li>
          <% end %>
          <% if @lti_claims[:canvas_workflow_state] %>
            <li><strong>코스 상태:</strong> <%= @lti_claims[:canvas_workflow_state] %></li>
          <% end %>
        </ul>

        <% if @lti_claims[:resource_link_id] %>
          <h4>Resource Link (과제/모듈) 정보</h4>
          <ul>
            <li><strong>Resource Link ID:</strong> <%= @lti_claims[:resource_link_id] %></li>
            <li><strong>Resource Link 제목:</strong> <%= @lti_claims[:resource_link_title] || "N/A" %></li>
            <li><strong>Resource Link 설명:</strong> <%= @lti_claims[:resource_link_description] || "N/A" %></li>
          </ul>
        <% end %>

        <h4>역할 정보</h4>
        <ul>
          <li><strong>역할:</strong> <%= @lti_claims[:user_role] == :instructor ? "강사" : "학생" %></li>
          <li><strong>전체 Roles:</strong> <%= @lti_claims[:user_roles].join(", ") if @lti_claims[:user_roles].is_a?(Array) %></li>
        </ul>

        <h4>LTI 정보</h4>
        <ul>
          <% if @lti_claims[:deployment_id] %>
            <li><strong>Deployment ID:</strong> <%= @lti_claims[:deployment_id] %></li>
          <% end %>
          <li><strong>Message Type:</strong> <%= @lti_claims[:message_type] || "N/A" %></li>
          <li><strong>Version:</strong> <%= @lti_claims[:version] || "N/A" %></li>
          <li><strong>Target Link URI:</strong> <%= @lti_claims[:target_link_uri] || "N/A" %></li>
          <li><strong>Issuer:</strong> <%= @lti_claims[:issuer] || "N/A" %></li>
          <li><strong>Audience (Client ID):</strong> <%= @lti_claims[:audience] || "N/A" %></li>
          <% if @lti_claims[:issued_at] %>
            <li><strong>발급 시간:</strong> <%= @lti_claims[:issued_at] %></li>
          <% end %>
          <% if @lti_claims[:expiration] %>
            <li><strong>만료 시간:</strong> <%= @lti_claims[:expiration] %></li>
          <% end %>
        </ul>

        <% if @lti_claims[:canvas_account_id] %>
          <h4>Canvas 추가 정보</h4>
          <ul>
            <li><strong>Account ID:</strong> <%= @lti_claims[:canvas_account_id] %></li>
          </ul>
        <% end %>
      </div>
    </details>
  </div>

  <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #ddd; color: #666; font-size: 12px;">
    <p>LTI 1.3 Launch가 성공적으로 완료되었습니다.</p>
  </div>
</div>

