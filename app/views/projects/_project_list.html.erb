<% if projects.present? && projects.any? %>
  <% projects.each do |project| %>
    <div class="project-card">
      <div class="project-header">
        <div>
          <h3 class="project-title">
            <%= link_to project[:name], project_path(project[:id]), class: 'text-decoration-none' %>
          </h3>
          <% if category == 'unpublished' %>
            <span class="badge badge-warning">ÎØ∏Í≥µÍ∞ú</span>
          <% end %>
        </div>
        <div class="project-actions">
          <%= link_to 'Î≥¥Í∏∞', project_path(project[:id]), class: 'btn btn-sm btn-outline-primary' %>
          <%= link_to 'ÏàòÏ†ï', edit_project_path(project[:id]), class: 'btn btn-sm btn-outline-secondary' %>
          <%= button_to 'ÏÇ≠Ï†ú', project_path(project[:id]), 
              method: :delete, 
              data: { confirm: 'Ï†ïÎßê ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?', turbo: false }, 
              class: 'btn btn-sm btn-outline-danger',
              form: { style: 'display: inline;' } %>
        </div>
      </div>
      
      <!-- STEP ÌëúÏãú -->
      <% if project[:assignments].present? && project[:assignments].any? %>
        <div class="steps-container">
          <% project[:assignments].each do |assignment| %>
            <% step_status = get_step_status(assignment) %>
            <div class="step-badge step-<%= step_status %>">
              <span class="step-name"><%= assignment['name'] || "STEP" %></span>
              <% if assignment['due_at'].present? %>
                <span class="step-date"><%= format_date(assignment['due_at']) %></span>
              <% end %>
            </div>
          <% end %>
        </div>
      <% end %>
      
      <!-- ÌÜµÍ≥Ñ ÌëúÏãú -->
      <% if @user_role == :instructor %>
        <% if project[:assignments].present? && project[:assignments].any? %>
          <div class="statistics">
            <% project[:assignments].each do |assignment| %>
              <div class="stat-item">
                <strong><%= assignment['name'] || "STEP" %>:</strong>
                <span class="badge <%= badge_class('submitted') %>">
                  Ï†úÏ∂ú: <%= assignment['submitted_count'] || 0 %>
                </span>
                <% if (assignment['grading_required'] || 0) > 0 %>
                  <span class="badge <%= badge_class('needs-grading') %>">
                    Ï±ÑÏ†ê ÌïÑÏöî: <%= assignment['grading_required'] || 0 %>
                  </span>
                <% elsif (assignment['graded_count'] || 0) > 0 %>
                  <span class="badge <%= badge_class('graded') %>">
                    Ï±ÑÏ†ê ÏôÑÎ£å: <%= assignment['graded_count'] || 0 %>
                  </span>
                <% end %>
              </div>
            <% end %>
          </div>
        <% end %>
      <% else %>
        <!-- ÌïôÏÉùÏö©: Ï†úÏ∂ú Ïó¨Î∂Ä ÌëúÏãú -->
        <% if project[:assignments].present? && project[:assignments].any? %>
          <div class="statistics">
            <% project[:assignments].each do |assignment| %>
              <div class="stat-item">
                <strong><%= assignment['name'] || "STEP" %>:</strong>
                <% if assignment['is_submitted'] %>
                  <span class="badge badge-success">Ï†úÏ∂ú ÏôÑÎ£å</span>
                <% else %>
                  <span class="badge badge-warning">ÎØ∏Ï†úÏ∂ú</span>
                <% end %>
              </div>
            <% end %>
          </div>
        <% end %>
      <% end %>
    </div>
  <% end %>
<% else %>
  <div class="empty-state">
    <div class="empty-state-icon">üìã</div>
    <p>ÌîÑÎ°úÏ†ùÌä∏Í∞Ä ÏóÜÏäµÎãàÎã§.</p>
    <% if category == 'current' || category == 'unpublished' %>
      <%= link_to 'ÏÉà ÌîÑÎ°úÏ†ùÌä∏Î•º ÏÉùÏÑ±', new_project_path, class: 'btn btn-primary' %>Ìï¥Î≥¥ÏÑ∏Ïöî.
    <% end %>
  </div>
<% end %>
